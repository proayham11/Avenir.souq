<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ - Avenir.Souq</title>
    <style>
        :root {
            --black: #0B0B0B;
            --dark-gray: #1E1E1E;
            --gray: #2A2A2A;
            --gold: #E5B839;
            --light-gray: #888888;
            --white: #F5F5F5;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--black);
            color: var(--white);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray);
        }
        
        .header h1 {
            color: var(--gold);
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .form-container {
            background-color: var(--dark-gray);
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid var(--gray);
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--white);
            font-weight: 500;
        }
        
        label.required::after {
            content: " *";
            color: #ff6b6b;
        }
        
        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 12px 15px;
            background-color: var(--black);
            border: 1px solid var(--gray);
            border-radius: 5px;
            color: var(--white);
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--gold);
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .btn-primary {
            background-color: var(--gold);
            color: var(--black);
        }
        
        .btn-primary:hover {
            background-color: #d4a32f;
        }
        
        .btn-secondary {
            background-color: var(--gray);
            color: var(--white);
            margin-left: 10px;
        }
        
        .btn-secondary:hover {
            background-color: var(--light-gray);
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .image-preview {
            width: 100px;
            height: 100px;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--gray);
        }
        
        

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-image {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .color-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background-color: var(--black);
            border-radius: 5px;
        }
        
        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid var(--white);
        }
        
        .remove-color {
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .add-btn {
            background-color: var(--gray);
            color: var(--white);
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 5px;
        }
        
        .add-btn:hover {
            background-color: var(--light-gray);
        }
        
        .message {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .error {
            background-color: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            color: #e74c3c;
        }
        
        .success {
            background-color: rgba(46, 204, 113, 0.2);
            border: 1px solid #2ecc71;
            color: #2ecc71;
        }
        
        .info-note {
            color: var(--light-gray);
            font-size: 0.85rem;
            margin-top: 5px;
            font-style: italic;
        }
        
        .image-url {
            margin-bottom: 10px;
        }
        
        .spec-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .spec-row input {
            flex: 1;
        }
    </style>
</head>
<body>
    <!-- Ø£Ø¶Ù ÙÙŠ Ù…ÙƒØ§Ù† Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø·Ø± 150 ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ -->
<div class="form-group">
    <label>Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ù…Ù† Ø§Ù„Ù„Ø§Ø¨ØªÙˆØ¨:</label>
    <div style="text-align: center; margin: 20px 0;">
        <button type="button" id="uploadLocalBtn" 
                style="background: #E5B839; color: black; padding: 15px 30px; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer;">
            ğŸ“¤ Ø±ÙØ¹ ØµÙˆØ± Ù…Ù† Ø§Ù„Ù„Ø§Ø¨ØªÙˆØ¨
        </button>
        <p style="color: #888; margin-top: 10px; font-size: 0.9rem;">
            Ø§Ø®ØªØ± ØµÙˆØ±Ø§Ù‹ Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ø±ÙØ¹Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©
        </p>
    </div>
</div>

<!-- Ø£Ø¶Ù ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù€ <script> Ù‚Ø¨Ù„ </script> -->
<script>
// Ø¯Ø§Ù„Ø© Ù„ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±
document.getElementById('uploadLocalBtn').addEventListener('click', function() {
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø¤Ù‚ØªØ§Ù‹
    const productData = {
        name: document.getElementById('name').value,
        price: document.getElementById('price').value,
        description: document.getElementById('description').value
    };
    localStorage.setItem('temp_product_data', JSON.stringify(productData));
    
    // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±ÙØ¹
    window.open('upload/local-upload.html', 'uploadWindow', 'width=700,height=600,scrollbars=yes');
});

// Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'images_uploaded') {
        const uploadedImages = event.data.images;
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„Ù„Ø­Ù‚ÙˆÙ„
        const imagesContainer = document.getElementById('images-container');
        uploadedImages.forEach(url => {
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'image-url';
            input.value = url;
            input.oninput = updateImagePreviews;
            imagesContainer.appendChild(input);
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        updateImagePreviews();
        
        alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ${uploadedImages.length} ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!`);
    }
});
</script>
    <div class="container">
        <div class="header">
            <h1 id="page-title">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h1>
            <p>Ø§Ù…Ù„Ø£ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø±</p>
        </div>
        
        <div id="message" class="message" style="display: none;"></div>
        
        <div class="form-container">
            <form id="product-form">
                <div class="form-group">
                    <label for="name" class="required">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
                    <input type="text" id="name" required placeholder="Ù…Ø«Ø§Ù„: USB C Hub 10-in-1">
                </div>
                
                <div class="form-group">
                    <label for="price" class="required">Ø§Ù„Ø³Ø¹Ø± ($)</label>
                    <input type="number" id="price" step="0.01" min="0" required placeholder="Ù…Ø«Ø§Ù„: 25.99">
                </div>
                
                <div class="form-group">
                    <label for="description" class="required">Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="description" required placeholder="Ø£Ø¯Ø®Ù„ ÙˆØµÙØ§Ù‹ Ù…ÙØµÙ„Ø§Ù‹ Ù„Ù„Ù…Ù†ØªØ¬..."></textarea>
                    <p class="info-note">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… &lt;br&gt; Ù„Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯</p>
                </div>
                
                <div class="form-group">
                    <label for="images" class="required">ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬</label>
                    <p class="info-note">Ø£ÙˆÙ„ ØµÙˆØ±Ø© Ø³ØªÙƒÙˆÙ† Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
                    <div id="images-container">
                        <input type="text" class="image-url" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (URL)">
                    </div>
                    <button type="button" class="add-btn" onclick="addImageField()">+ Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø£Ø®Ø±Ù‰</button>
                    <div id="image-preview-container" class="image-preview-container"></div>
                </div>
                
                <div class="form-group">
                    <label>Ø§Ù„Ø£Ù„ÙˆØ§Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <div id="colors-container">
                        <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù‡Ù†Ø§ -->
                    </div>
                    <button type="button" class="add-btn" onclick="addColorField()">+ Ø¥Ø¶Ø§ÙØ© Ù„ÙˆÙ†</button>
                </div>
                
                <div class="form-group">
                    <label>Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <div id="specs-container">
                        <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ù‡Ù†Ø§ -->
                    </div>
                    <button type="button" class="add-btn" onclick="addSpecField()">+ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§ØµÙØ©</button>
                </div>
                
                <div class="form-actions">
                    <a href="manage-products.html" class="btn btn-secondary">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</a>
                    <button type="submit" class="btn btn-primary" id="submitBtn">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function checkAdminLogin() {
            const loggedIn = localStorage.getItem('adminLoggedIn');
            const loginTime = localStorage.getItem('adminLoginTime');
            const now = new Date().getTime();
            
            if (!loggedIn || loggedIn !== 'true' || !loginTime || (now - loginTime) > 8 * 60 * 60 * 1000) {
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminLoginTime');
                window.location.href = 'admin-login.html';
                return false;
            }
            return true;
        }
        
        // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        if (!checkAdminLogin()) {
            // Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        }
        
        // ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        let isEditMode = !!productId;
        let editProductId = isEditMode ? parseInt(productId) : null;
        
        if (isEditMode) {
            document.getElementById('page-title').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬';
            document.getElementById('submitBtn').textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬';
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯
        function addImageField() {
            const container = document.getElementById('images-container');
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'image-url';
            input.placeholder = 'Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (URL)';
            input.oninput = updateImagePreviews;
            container.appendChild(input);
        }
        
        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±
        function updateImagePreviews() {
            const container = document.getElementById('image-preview-container');
            const inputs = document.querySelectorAll('.image-url');
            container.innerHTML = '';
            
            inputs.forEach((input, index) => {
                if (input.value.trim()) {
                    const preview = document.createElement('div');
                    preview.className = 'image-preview';
                    preview.innerHTML = `
                        <img src="${input.value}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© ${index + 1}" 
                             onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\'width:100%;height:100%;background:#333;display:flex;align-items:center;justify-content:center;color:#888\'>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©</div>'">
                        <button type="button" class="remove-image" onclick="removeImage(${index})">Ã—</button>
                    `;
                    container.appendChild(preview);
                }
            });
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø²Ø§Ù„Ø© ØµÙˆØ±Ø©
        function removeImage(index) {
            const inputs = document.querySelectorAll('.image-url');
            if (inputs[index]) {
                inputs[index].value = '';
                updateImagePreviews();
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ù„ÙˆÙ† Ø¬Ø¯ÙŠØ¯
        function addColorField(colorName = '', colorCode = '#000000') {
            const container = document.getElementById('colors-container');
            const colorDiv = document.createElement('div');
            colorDiv.className = 'color-option';
            colorDiv.innerHTML = `
                <input type="color" class="color-code" value="${colorCode}" style="width: 50px; height: 40px;">
                <input type="text" class="color-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„ÙˆÙ†" value="${colorName}">
                <div class="color-preview" style="background-color: ${colorCode}"></div>
                <button type="button" class="remove-color" onclick="this.parentElement.remove()">Ã—</button>
            `;
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù„ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±
            const colorInput = colorDiv.querySelector('.color-code');
            const preview = colorDiv.querySelector('.color-preview');
            colorInput.addEventListener('input', function() {
                preview.style.backgroundColor = this.value;
            });
            
            container.appendChild(colorDiv);
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ù…ÙˆØ§ØµÙØ§Øª Ø¬Ø¯ÙŠØ¯
        function addSpecField(name = '', value = '') {
            const container = document.getElementById('specs-container');
            const specDiv = document.createElement('div');
            specDiv.className = 'spec-row';
            specDiv.innerHTML = `
                <input type="text" class="spec-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ§ØµÙØ©" value="${name}">
                <input type="text" class="spec-value" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©" value="${value}">
                <button type="button" class="remove-color" onclick="this.parentElement.remove()">Ã—</button>
            `;
            container.appendChild(specDiv);
        }
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø©
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
        if (isEditMode) {
            try {
                const products = JSON.parse(localStorage.getItem('avenir_products')) || [];
                const product = products.find(p => p.id === editProductId);
                
                if (product) {
                    document.getElementById('name').value = product.name || '';
                    document.getElementById('price').value = product.price || '';
                    document.getElementById('description').value = product.description || '';
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±
                    const imagesContainer = document.getElementById('images-container');
                    imagesContainer.innerHTML = '';
                    if (product.images && product.images.length > 0) {
                        product.images.forEach((img, index) => {
                            const input = document.createElement('input');
                            input.type = 'text';
                            input.className = 'image-url';
                            input.value = img;
                            input.oninput = updateImagePreviews;
                            imagesContainer.appendChild(input);
                        });
                    } else {
                        addImageField();
                    }
                    updateImagePreviews();
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù†
                    if (product.colors && product.colors.length > 0) {
                        product.colors.forEach(color => {
                            addColorField(color.name, color.code);
                        });
                    }
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª
                    if (product.specs && product.specs.length > 0) {
                        product.specs.forEach(spec => {
                            addSpecField(spec.name, spec.value);
                        });
                    }
                } else {
                    showMessage('Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                }
            } catch (e) {
                showMessage('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬', 'error');
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø­ÙØ¸ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById('product-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!checkAdminLogin()) return;
            
            // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
            const name = document.getElementById('name').value.trim();
            const price = document.getElementById('price').value.trim();
            const description = document.getElementById('description').value.trim();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            if (!name || !price || !description) {
                showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©', 'error');
                return;
            }
            
            // Ø¬Ù…Ø¹ Ø§Ù„ØµÙˆØ±
            const imageInputs = document.querySelectorAll('.image-url');
            const images = Array.from(imageInputs)
                .map(input => input.value.trim())
                .filter(url => url !== '');
            
            if (images.length === 0) {
                showMessage('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                return;
            }
            
            // Ø¬Ù…Ø¹ Ø§Ù„Ø£Ù„ÙˆØ§Ù†
            const colorDivs = document.querySelectorAll('.color-option');
            const colors = Array.from(colorDivs).map(div => ({
                name: div.querySelector('.color-name').value.trim(),
                code: div.querySelector('.color-code').value
            })).filter(color => color.name !== '');
            
            // Ø¬Ù…Ø¹ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª
            const specRows = document.querySelectorAll('.spec-row');
            const specs = Array.from(specRows).map(row => ({
                name: row.querySelector('.spec-name').value.trim(),
                value: row.querySelector('.spec-value').value.trim()
            })).filter(spec => spec.name !== '' && spec.value !== '');
            
            // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©
            const product = {
                id: isEditMode ? editProductId : Date.now(),
                name,
                price,
                description: description.replace(/\n/g, '<br>'),
                images,
                mainImage: images[0], // Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                specs,
                colors,
                createdAt: isEditMode ? undefined : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬
            try {
                let products = [];
                const stored = localStorage.getItem('avenir_products');
                if (stored) {
                    products = JSON.parse(stored);
                }
                
                if (isEditMode) {
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
                    const index = products.findIndex(p => p.id === editProductId);
                    if (index !== -1) {
                        products[index] = product;
                        showMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    } else {
                        products.push(product);
                        showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    }
                } else {
                    // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
                    products.push(product);
                    showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
                
                localStorage.setItem('avenir_products', JSON.stringify(products));
                
                // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸
                setTimeout(() => {
                    window.location.href = `manage-products.html?${isEditMode ? 'updated=true' : 'saved=true'}`;
                }, 1500);
                
            } catch (error) {
                showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬: ' + error.message, 'error');
            }
        });
        
        // Ø¥Ø¶Ø§ÙØ© Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        window.onload = function() {
            if (!isEditMode) {
                addImageField(); // Ø­Ù‚Ù„ ØµÙˆØ±Ø© Ø¥Ø¶Ø§ÙÙŠ
            }
        };
    </script>
</body>
</html>